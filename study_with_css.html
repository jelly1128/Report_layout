<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>検査要約レポート（モック）</title>
  
  <style>
  /* ========== 基本：紙ベースの単位で定義 ========== */
  :root {
    --page-w: 210mm;            /* A4 幅 */
    --page-h: 297mm;            /* A4 高 */
    --page-margin: 5mm;        /* 印刷余白（PDFに合わせて調整） */
    --rule-thick: 0.8mm;
    --font-jp: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
              "BIZ UDPGothic";
              /* "Meiryo"; */
  }
  /* 全要素のボックスサイズ計算方式を統一 */
  * {
    box-sizing: border-box; 
    /* paddingやborderをwidth/heightに含める。
      印刷物のレイアウト崩れを防ぐための必須設定 */
  }

  /* HTML文書全体とbodyに共通する基本設定 */
  html, body { 
    margin: 0;                   /* ブラウザ標準の余白をリセット */
    font-family: var(--font-jp); /* デフォルトのフォントを日本語対応スタックに指定 */
    color: #111;               /* テキストの基本色（#000より柔らかい黒） */
    line-height: 1.2;            /* 行間。読みやすさと印刷適正を考慮した倍率 */
    letter-spacing: .04em;       /* 文字間。読みやすさと印刷適正を考慮した倍率 */
  }

  /* 1ページ=1シート。画面でも印刷でも同じ寸法になるよう mm で固定 */
  .sheet {
    width: calc(var(--page-w) - var(--page-margin) * 2);
    min-height: calc(var(--page-h) - var(--page-margin) * 2);
    margin : 0;
    padding: 0;                 /* 余白はCSSの@page規則で制御。ここでは0にしておく */
  }

  /* =============================
   ヘッダー部分（検査レポートのタイトル行）
   左：大見出し（h1）
   右：日付や患者IDなどのメタ情報
   ============================= */
  .report-header {
    display: grid;                    /* グリッドレイアウトで左右に分割 */
    grid-template-columns: 1fr auto;  /* 左,右カラム：可変幅（1fr）自動調整（auto） */
    align-items: end;                 /* 下揃え */
    gap: 6mm;                         /* カラム間の隙間 */
    padding-top: 0mm;
  }

  /* 大見出し */
  .report-title { 
    margin: 0;              /* デフォルトの余白を削除 → レイアウト崩れ防止 */
    font-weight: 700;       /* 太字で強調 */
    font-size: 32pt;        /* 大きな文字サイズでタイトル感を出す */
  }

  /* メタ情報部分（右側：日付・患者IDなど） */
  .report-meta { 
    display: flex;             /* ← gridからflexに変更 */
    flex-direction: row;       /* 横並びにする */
    align-items: flex-end;     /* ベースラインを下で揃える */
    gap: 8mm;                  /* 日付と患者IDの間隔 */
    font-size: 16pt;
  }

  /* ヘッダーの太線 */
  .header-thick { 
    border:0;
    margin: 3mm 0 5mm;
    border-top: var(--rule-thick) solid #000;
  }

  /* ============================================
   検査サマリー全体ブロック
   左カラム：検査で使用した薬剤や観察条件（表形式）
   右カラム：検査開始/終了時刻や体位図など
   ============================================ */
  .exam-summary {
    display: grid;
    grid-template-columns: auto auto; /* 左：表（可変幅） / 右：補足情報（幅は内容に応じて自動） */
    align-items: start; /* 上揃えにして、左右の要素の高さが違っても自然に見せる */
  }

  /* --------------------------------------------
    左カラム：タイトル＋リスト部分
    -------------------------------------------- */

  /* 「使用・観察時間」などの小見出しタイトル */
  .exam-summary__title { 
    margin: 0;             /* デフォルト余白を削除して整列 */
    font-weight: 700;      /* 太字で強調 */
    font-size: 20pt;       /* 本文より大きめで見出し感を出す */
  }

  /* 検査条件をまとめた表（薬剤使用有無・観察時間） */
  .exam-summary__table {
    width: 100%;                 /* 横幅いっぱいに広げる */
    border-collapse: collapse;   /* セルの間隔を詰めてスッキリ */
    font-size: 16pt;             /* 本文よりやや大きめで読みやすく */
  }

  /* 表セルの基本スタイル */
  .exam-summary__table td {
    padding: 0.4em 0.4em; /* 適度な内側余白 */
    border: none;         /* 枠線を消してシンプルに */
    text-align: left;     /* デフォルトは左寄せ */
  }

  /* 見出しセル（th）の強調 */
  .exam-summary__table th {
    font-weight: bold;    /* 太字でラベル感を出す */
  }

  /* 1列目（処置内容）を固定幅に */
  .exam-summary__table td:nth-child(1),
  .exam-summary__table th:nth-child(1) {
    width: 70mm;
  }

  /* 2列目（使用有無：○×）を中央寄せ */
  .exam-summary__table td:nth-child(2),
  .exam-summary__table th:nth-child(2) {
    text-align: center;
    /* width: 25mm;  ← 必要なら固定幅を指定 */
  }

  /* 3列目（観察時間）を中央寄せ */
  .exam-summary__table td:nth-child(3),
  .exam-summary__table th:nth-child(3) {
    text-align: center;
    /* width: 30mm;  ← 必要なら固定幅を指定 */
  }

  .exam-summary__biopsy-info {
    display: grid;                /* 2カラム構成にする */
    grid-template-columns: 70mm 1fr; /* 左: 70mm固定 / 右: 残りを可変 */
    padding: 0.4em 0.4em;   /* 表セルと同じ内側余白 */
    margin-top: 3mm;        /* 表との間に余白を確保 */
    font-size: 16pt;        /* 表より少し小さめの文字で注釈っぽく */
  }

  .biopsy-label {
    text-align: left;          /* 左寄せ */
    width: 70mm;
  }

  .biopsy-target {
    text-align: left;         /* 左寄せ */
  }

  /* --------------------------------------------
   右カラム：開始・終了時刻や体位図
   -------------------------------------------- */

  /* 検査開始/終了時刻のまとめブロック */
  .exam-summary__times {
    display: flex;              /* 縦方向に並べるためにflexを利用 */
    flex-direction: column;     /* 要素を縦並びに配置 */
    align-items: flex-end;      /* 中身を右寄せ（時間を右揃え表示） */
    gap: 3mm;                   /* 各行の間隔（印刷基準なのでmmで指定推奨） */
    font-size: 14pt;            /* 本文と同じサイズ */
  }

  /* 検査体位図（体のイラスト画像） */
  .exam-summary__position-image {
    margin-top: 6mm;            /* 上に余白を確保して本文と分離 */
    display: block;             /* 余計なインライン余白を消す */
    height: auto;               /* アスペクト比を保持したまま縮小拡大 */
    max-width: 60mm;            /* 印刷時の紙面に収まるよう最大幅を制限 */
  }

  .label { white-space: nowrap; }
  .mark { text-align: center;}
  .mark--circle::after { content: "○";}
  .mark--cross::after { content: "×";}
  .time { text-align: right;}
  .time_title { text-align: right;}

  .timeline-block {
    display: grid;
    margin-top: 0mm;
    gap: 4mm;
    padding: 0 6mm;           /* 左右だけ余白 */
    break-inside: avoid; /* ページ内で分割しない */
  }

  .timeline-row {
    display: grid;
    grid-template-columns: auto 1fr; /* 左：キャプション / 右：画像 */
    align-items: center;
    gap: 4mm;
  }

  .timeline-caption {
    font-size: 18pt;
    white-space: nowrap;
  }

  .timeline {
    position: relative;  /* マーカーの基準位置 */
    width: 100%;
    height: auto;
    box-sizing: border-box;    /* 枠線を含めてサイズ計算 */
  }

  .timeline img {
    display: block;
    width: 100%;   /* 横幅いっぱいに伸ばす */
    height: auto;
    border: 2px solid #000000; /* 画像の枠線 */
  }

  /* 時間ラベルのコンテナ */
  .timeline-header {
    display: grid;
    grid-template-columns: auto 1fr; /* 左: キャプション / 右: 内容 */
    align-items: center;
    /* gap: 4mm; */
    margin-bottom: 4mm;  /* 下に少し余白 */
  }

  .timeline-header .timeline-caption {
    font-size: 14pt;
    /* font-weight: bold; */
    white-space: nowrap;
  }

  .timeline-header .timeline {
    border-bottom: 1px solid transparent; /* 高さ確保用 */
  }

  .time-markers {
    position: absolute;
    top: -9mm;   /* 画像の上に配置 */
    left: 0;
    width: 100%;
    height: 0;    /* 高さは不要（中身で決まる） */
    pointer-events: none;
  }

  /* 各時間ラベル */
  .time-marker {
    position: absolute;
    transform: translateX(-50%);
    font-size: 14pt;
    /* font-weight: bold; */
    white-space: nowrap;
  }

  .markers {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;    /* 画像幅に追従 */
    height: 100%;   /* 画像高さに追従 */
    z-index: 1;     /* 画像の上に重ねる */
    pointer-events: none;
  }

  /* マーカー（縦線） */
  .marker {
    position: absolute;
  }

  /* マーカーのラベル */
  .marker > span {
    position: absolute;
    left: 0;
    transform: translateX(-50%);    /* 棒の中央に合わせる */
    font-size: 20pt;
  }

  .marker.level1 > span { top: -15mm; }
  .marker.level2 > span { top: -23mm; }
  .marker.level3 > span { top: -31mm; }
  .marker.level0 > span { top: 0mm; }

  .thick2{ 
    border:0; 
    margin: 8mm 0 5mm; 
    border-top: var(--rule-thick) solid #000; 
  }

  /* サムネイルギャラリー */
  .gallery {
    display: grid;
  }

  .gallery-block {
    display: grid;
    grid-template-columns: 50mm 1fr; /* 左：キャプション / 右：画像群 */
    margin-top: 4mm;
    align-items: start; /* 上揃え */
  }

  .gallery-caption {
    font-size: 14pt;
    white-space: nowrap;
  }

  /* キャプションの A,B,C だけ強調 */
  .gallery-caption strong {
    font-size: 24pt;
    display: inline-block;
  }

  .gallery-thumbnails {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 最大3列固定 */
    gap: 4mm;
  }

  /* サムネイル番号ラベル */
  .thumb {
    position: relative;
  }

  .thumb-label {
    position: absolute;
    top: 4px;
    left: 4px;
    background: #ffffff;
    font-size: 12pt;
    font-weight: bold;
    padding: 2px 6px;
    border: 1px solid #333;
    border-radius: 4px;
  }

  .gallery-thumbnails img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  .gallery-block:nth-of-type(3) {
    break-before: page;   /* WeasyPrint / 印刷用CSS */
  }


  /* ========== 印刷設定 ========== */
  @page{
    size: A4;
    margin: var(--page-margin); 
    /* 紙の余白をCSSで直接指定。プレビューも印刷もこれを基準にする */
  }

/* 画面表示（プレビュー用） */
  @media screen {
    body{ background:#ffffff; }
    .sheet{
      /* 画面のときだけ周囲に余白を足し、紙感を出す */
      margin: 0 auto; /* 水平方向の中央寄せだけ残す（任意） */
      padding: var(--page-margin);     /* 余白は @page に統一 */
      box-shadow: 0 0 1mm rgba(0, 0, 0, 0.5);
    }
  }

  /* 印刷の色ズレ・薄色対策（対応ブラウザで有効） */
  @media print {
    * { 
    -webkit-print-color-adjust: exact; 
    print-color-adjust: exact; 
    /* 色ズレや淡色の印刷補正を有効化 */
    }
    .sheet {
    padding: 0;
    box-shadow: none; /* 印刷時は影を消す（保険） */
    page-break-after: always;
    }
    .sheet:last-of-type {
      break-after: auto;       /* 最終ページは改ページしない */
      page-break-after: auto;
    }
  }


  /* 画像と線幅の安定化 */
  img{ max-width:100%; height:auto; }
  hr{ border-top-width: var(--rule-thick); }

  </style>

</head>
<body>
  <!-- 1ページ=1シート。複数ページになったら .sheet を増やす -->
  <main class="sheet">
    <!--HEADER-->
    <header class="report-header">
      <div class="report-title">検査レポート</div>
      <div class="report-meta">
        <div>9月18日</div>
        <div>【患者ID　　　　】</div>
      </div>
    </header>
    <hr class="header-thick" />
    <!-- …本文… -->
    <!-- 検査サマリー（使用薬剤・観察時間・開始/終了時刻・体位図） -->
    <section class="exam-summary">

      <!-- 左カラム：使用薬剤や観察時間の表 -->
      <div class="exam-summary__left">
        <table class="exam-summary__table">
          <thead>
            <tr>
              <th></th>
              <th class="time_title">使用</th>
              <th class="time_title">観察時間</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="label">ルゴール</td>
              <td class="mark">○</td>
              <td class="time">1分32秒</td>
            </tr>
            <tr>
              <td class="label">インディゴカルミン</td>
              <td class="mark">○</td>
              <td class="time">1分1秒</td>
            </tr>
            <tr>
              <td class="label">狭帯域光（NBI・BLI）使用</td>
              <td class="mark">○</td>
              <td class="time">–</td>
            </tr>
          </tbody>
        </table>

        <!-- 生検 -->
        <div class="exam-summary__biopsy-info">
          <span class="biopsy-label">内視鏡下生検法</span>
          <span class="biopsy-target">食道</span>
          <!-- <span class="biopsy-target">胃・十二指腸</span> -->
          <!-- <span class="biopsy-target">食道，胃・十二指腸</span> -->
        </div>
      </div>

      <!-- 右カラム：検査開始・終了時刻と体位図 -->
      <aside class="exam-summary__times">
        <div>検査開始時刻　9:00</div>
        <div>終了時刻　　　9:19</div>

        <div class="exam-summary__position-image">
          <img src="position.png" alt="検査体位図" />
        </div>
      </aside>

    </section>


    <!-- タイムライン -->
    <section class="timeline-block">
       <!-- 経過時間キャプションを1行目に -->
      <div class="timeline-header">
        <div class="timeline-caption">経過時間</div>
        <div class="timeline"></div>
      </div>
      <div class="timeline-row">
        <div class="timeline-caption">臓器</div>
        <div class="timeline">
          <!-- 時間ラベル（拡張可能） -->
          <div class="time-markers">
            <div class="time-marker" style="left: 0%;"><span>0:00</span></div>
            <div class="time-marker" style="left: 25%;"><span>4:45</span></div>
            <div class="time-marker" style="left: 50%;"><span>9:30</span></div>
            <div class="time-marker" style="left: 75%;"><span>14:15</span></div>
            <div class="time-marker" style="left: 100%;"><span>19:00</span></div>
          </div>
          <img src="outputs\20211021093634_000001-001\20211021093634_000001-001_organ_timeline.png">
        </div>
      </div>
      <div class="timeline-row">
        <div class="timeline-caption">処置</div>
        <div class="timeline">
          <div class="markers">
            <div class="marker level0" style="left: 21.3%;"><span>A</span></div>
            <div class="marker level0" style="left: 59.4%;"><span>B</span></div>
            <div class="marker level0" style="left: 76%;"><span>C</span></div>
          </div>
          <img src="outputs\20211021093634_000001-001\20211021093634_000001-001_treatment_timeline.png">
        </div>
        </div>
      </div>
      <div class="timeline-row">
        <div class="timeline-caption">生検</div>
        <div class="timeline">
          <div class="markers">
            <div class="marker level0" style="left: 80.9%;"><span>D</span></div>
          </div>
          <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_forceps_timeline.png">
        </div>
      </div>
    </section>
    <hr class="thick2" />
    <!-- サムネイルギャラリー -->
    <section class="gallery">
      <div class="gallery-block">
        <div class="gallery-caption"><strong>A</strong><br>食道<br>狭帯域光<br>90%</div>
        <div class="gallery-thumbnails">
          <div class="thumb">
          <span class="thumb-label">A<small>1</small> <span>3:32</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_3_top_0.png" alt="">
          </div>
          <div class="thumb">
            <span class="thumb-label">A<small>2</small> <span>3:46</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_3_top_1.png" alt="">
          </div>
          <div class="thumb">
            <span class="thumb-label">A<small>3</small> <span>3:52</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_3_top_2.png" alt="">
          </div>
        </div>
      </div>

      <div class="gallery-block">
        <div class="gallery-caption"><strong>B</strong><br>十二指腸<br>インディゴカルミン<br>90%</div>
        <div class="gallery-thumbnails">
          <div class="thumb">
            <span class="thumb-label">B<small>1</small> <span>11:01</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_2_top_0.png" alt="">
          </div>
          <div class="thumb">
            <span class="thumb-label">B<small>2</small> <span>11:07</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_2_top_1.png" alt="">
          </div>
          <!-- <div class="thumb"> -->
            <!-- <span class="thumb-label">B<small>3</small> <span>11:13</span></span> -->
            <!-- <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_2_top_2.png" alt=""> -->
          <!-- </div> -->
        </div>
      </div>

      <div class="gallery-block">
        <div class="gallery-caption"><strong>C</strong><br>食道<br>ルゴール</div>
        <div class="gallery-thumbnails">
          <div class="thumb">
            <span class="thumb-label">C<small>1</small> <span>14:22</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_1_top_0.png" alt="">
          </div>
          <div class="thumb">
            <span class="thumb-label">C<small>2</small> <span>15:11</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_1_top_1.png" alt="">
          </div>
          <div class="thumb">
            <span class="thumb-label">C<small>3</small> <span>15:20</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_thumnail_label_1_top_2.png" alt="">
          </div>
        </div>
      </div>

      <div class="gallery-block">
        <div class="gallery-caption"><strong>D</strong><br>食道<br>生検<br>85%</div>
        <div class="gallery-thumbnails">
          <div class="thumb">
            <span class="thumb-label">D<small>1</small> <span>15:22</span></span>
            <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_3544.png" alt="">
          </div>
          <!-- <div class="thumb"> -->
            <!-- <span class="thumb-label">D<small>2</small> <span>15:32</span></span> -->
            <!-- <img src="outputs/20211021093634_000001-001/20211021093634_000001-001_3573.png" alt=""> -->
          <!-- </div> -->
        </div>
      </div>

    </section>
  </main>
</body>
</html>